<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é«˜é›„ Â· é™³å…¶é‚å¸‚é•·ä»»å…§æ´»å‹•åœ°åœ–ï¼ˆ2020â€“2026/01/01ï¼‰</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    *{ box-sizing:border-box; }
    html, body{ height:100%; overflow:hidden; }
    body{
      margin:0;
      font-family:"AR æµªæ¼«æ˜æœé«”","Noto Serif TC","Noto Sans TC",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",serif;
      background:
        radial-gradient(circle at top left, rgba(220,205,196,0.65), transparent 55%),
        radial-gradient(circle at bottom right, rgba(182,196,201,0.75), #f4f1ec);
      color:#3f3f46;
    }

    .app{ height:100dvh; display:flex; flex-direction:column; min-height:0; }

    .header{
      padding:10px 18px;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid rgba(148,133,121,0.4);
      background: linear-gradient(to right, #d8c3a5, #e3d5ca, #c9ada7);
      gap:10px;
    }
    .title{
      display:flex; flex-direction:column; gap:3px;
      min-width: 260px;
    }
    .title h1{
      margin:0;
      font-size:18px; font-weight:800; letter-spacing:.12em;
      text-transform:uppercase;
      color:#403b33;
    }
    .title .sub{
      font-size:12px;
      color:#5b5b63;
    }
    .badge{
      font-size:11px;
      padding:6px 12px;
      border-radius:999px;
      border:1px solid rgba(112,99,88,0.5);
      background: rgba(244,241,236,0.75);
      display:inline-flex; align-items:center; gap:8px;
      color:#3f3f46; white-space:nowrap;
    }
    .badge-dot{
      width:7px; height:7px; border-radius:999px;
      background:#9a8c98;
      box-shadow:0 0 0 3px rgba(154,140,152,0.35);
    }

    .main{
      flex:1;
      display:grid;
      grid-template-columns:minmax(0,1.35fr) minmax(0,1.65fr);
      min-height:0;
    }

    .map-wrapper{ padding:14px 14px 14px 18px; }
    .map-card{
      height:100%;
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(148,133,121,0.5);
      box-shadow:0 20px 35px rgba(64,59,51,0.25);
    }
    #map{ height:100%; width:100%; }

    .sidebar{
      padding:14px 18px 12px;
      display:flex; flex-direction:column;
      border-left:1px solid rgba(148,133,121,0.45);
      background: linear-gradient(to bottom, rgba(244,241,236,0.85), rgba(227,213,202,0.85));
      min-height:0;
      overflow:hidden;
    }

    .scope-title{
      font-size:17px; font-weight:800; color:#5e503f;
      margin-bottom:2px;
    }
    .scope-sub{
      font-size:13px; color:#6b7280;
    }
    .hint{
      margin-top:8px;
      font-size:12px; color:#78716c;
      line-height:1.4;
    }

    .row{ margin-top:10px; display:flex; flex-wrap:wrap; gap:6px; align-items:center; }

    /* ç¸®åœ–æŒ‰éˆ•ï¼ˆå¯é»æ“Šæ”¾å¤§ï¼‰ */
    .thumb-btn{
      appearance:none;
      border:none;
      padding:0;
      cursor:pointer;
      text-align:left;
    }
    .thumb-btn:focus-visible{
      outline:3px solid rgba(185,87,86,0.45);
      outline-offset:2px;
    }

    /* Lightbox æ”¾å¤§æª¢è¦– */
    .lightbox{
      position:fixed;
      inset:0;
      display:none;
      z-index:9999;
    }
    .lightbox.open{ display:block; }
    .lightbox-backdrop{
      position:absolute;
      inset:0;
      background: rgba(15,15,15,0.72);
      backdrop-filter: blur(2px);
    }
    .lightbox-panel{
      position:absolute;
      left:50%;
      top:50%;
      transform: translate(-50%,-50%);
      width:min(92vw, 980px);
      max-height: 88vh;
      background: rgba(253,253,252,0.98);
      border:1px solid rgba(200,182,166,0.9);
      border-radius:18px;
      box-shadow: 0 30px 60px rgba(0,0,0,0.35);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .lightbox-close{
      position:absolute;
      right:10px;
      top:10px;
      width:34px;
      height:34px;
      border-radius:12px;
      border:1px solid rgba(112,99,88,0.45);
      background: rgba(244,241,236,0.95);
      cursor:pointer;
      font-size:18px;
      line-height:1;
      color:#403b33;
    }
    .lightbox-imgwrap{
      padding:12px 12px 0;
      display:flex;
      justify-content:center;
      align-items:center;
      min-height: 220px;
    }
    .lightbox-panel img{
      max-width:100%;
      max-height: calc(88vh - 130px);
      border-radius:14px;
      border:1px solid rgba(148,133,121,0.35);
      background: #f4f1ec;
    }
    .lightbox-meta{
      padding:10px 14px 14px;
      border-top:1px solid rgba(200,182,166,0.55);
      background: linear-gradient(to bottom, rgba(244,241,236,0.95), rgba(227,213,202,0.9));
      font-size:12px;
      color:#403b33;
      display:flex;
      flex-direction:column;
      gap:6px;
      word-break:break-all;
    }
    .lightbox-meta a{
      color:#B95756;
      text-decoration: underline;
      text-underline-offset: 2px;
    }


    /* å¹´ä»½æŒ‰éˆ•ï¼šæ¸…æ¥šå¯è®€ã€é¿å…æ’è‰² */
    .pill{
      font-size:11px;
      padding:7px 12px;
      border-radius:999px;
      border:1px solid #c8b6a6;
      background:#e3d5ca;
      color:#1f2937;
      cursor:pointer;
      transition:transform .08s, border-color .18s, background .18s;
    }
    .pill:hover{ transform: translateY(-1px); border-color:#9a8c98; }
    .pill.active{
      background:#c9ada7;
      border-color:#9a8c98;
      color:#111827;
      font-weight:900;
    }

    .btn{
      margin-left:auto;
      font-size:11px;
      padding:7px 10px;
      border-radius:12px;
      border:1px solid rgba(112,99,88,0.5);
      background: rgba(244,241,236,0.9);
      color:#403b33;
      cursor:pointer;
    }

    .event-list{
      margin-top:10px;
      flex:1;
      overflow-y:auto;
      padding-right:4px;
      min-height:0;
    }

    .event-card{
      background:#fdfdfc;
      border-radius:14px;
      padding:10px 12px;
      margin-bottom:10px;
      border:1px solid rgba(200,182,166,0.9);
      box-shadow:0 12px 25px rgba(64,59,51,0.12);
    }
    .event-header{ display:flex; align-items:baseline; gap:8px; margin-bottom:6px; flex-wrap:wrap; }
    .event-date{
      font-size:12px;
      padding:2px 8px;
      border-radius:999px;
      background:#d8e2dc;
      color:#344054;
      border:1px solid #b5c3c7;
      white-space:nowrap;
    }
    .event-name{ font-size:14px; font-weight:900; color:#3b3a3a; }

    .event-meta{
      display:flex; flex-wrap:wrap; gap:6px;
      font-size:12px; color:#6b6b6b;
      margin-bottom:8px;
    }
    .tag{
      display:inline-flex; align-items:center; gap:6px;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid #c8b6a6;
      font-size:11px;
      background:#f4f1ec;
    }
    .tag-dot{ width:6px; height:6px; border-radius:999px; background:#9a8c98; }

    .photo-row{
      margin-top:6px;
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(92px, 1fr));
      gap:6px;
    }
    .thumb{
      position:relative;
      width:100%;
      padding-bottom:65%;
      border-radius:10px;
      overflow:hidden;
      border:1px solid rgba(148,133,121,0.85);
      background-position:center;
      background-size:cover;
      background-repeat:no-repeat;
      background-color: rgba(244,241,236,0.9);
    }
    .thumb.placeholder::after{
      content:"å°šæœªåŠ å…¥ç…§ç‰‡";
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      font-size:11px;
      color:#fdfdfc;
      text-shadow:0 1px 3px rgba(0,0,0,0.8);
      background: linear-gradient(to top, rgba(64,59,51,0.92), rgba(64,59,51,0.28));
    }

    .missing-box{
      margin-top:9px;
      padding:9px 10px;
      border-radius:12px;
      border:1px dashed rgba(154,140,152,0.8);
      background: rgba(244,241,236,0.9);
      color:#403b33;
      font-size:12px;
      line-height:1.45;
      word-break:break-all;
    }
    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size:11px;
    }

    /* åœ–é‡˜ icon */
    .pin-icon{ background:transparent; border:none; }
    .pin-icon svg{ filter: drop-shadow(0 10px 10px rgba(64,59,51,0.25)); }

    .footer{
      padding:8px 18px 10px;
      font-size:11px;
      color:#6b6b6b;
      border-top:1px solid rgba(148,133,121,0.5);
      background:#e3d5ca;
    }

    @media (max-width: 960px){
      .header{ flex-direction:column; align-items:flex-start; }
      .main{
        grid-template-columns:1fr;
        grid-template-rows:minmax(280px, 46vh) minmax(0, 54vh);
      }
      .map-wrapper{ padding:10px 12px 6px; }
      .sidebar{ border-left:none; border-top:1px solid rgba(148,133,121,0.45); }
    }
  </style>
</head>

<body>
  <div class="app">
    <header class="header">
      <div class="title">
        <h1>KAOHSIUNG EVENTS MAP</h1>
        <div class="sub">é™³å…¶é‚ä»»å…§æ´»å‹•æ•´ç† Â· 2020â€“2026/01/01ï¼ˆå¯é€æ­¥è£œç…§ç‰‡ï¼‰</div>
      </div>
      <div class="badge"><span class="badge-dot"></span>é»åœ°åœ–åœ–é‡˜ â†’ å³å´çœ‹è©²åœ°é»æ­·å¹´æ´»å‹•</div>
    </header>

    <div class="main">
      <div class="map-wrapper">
        <div class="map-card"><div id="map"></div></div>
      </div>

      <aside class="sidebar">
        <div class="scope-title" id="scopeTitle">å…¨éƒ¨åœ°é»</div>
        <div class="scope-sub" id="scopeSub">ç›®å‰é¡¯ç¤ºï¼šå…¨éƒ¨å¹´ä»½ Â· å…¨éƒ¨æ´»å‹•</div>
        
        <div class="row">
          <span class="select-label">åœ°é»</span>
          <select id="placeSelect" class="select" aria-label="é¸æ“‡åœ°é»"></select>
        </div>
        <div class="row" id="yearFilters"></div>

        <div class="row">
          <button class="btn" id="clearPlace">æ¸…é™¤åœ°é»ç¯©é¸ï¼ˆå›åˆ°å…¨éƒ¨ï¼‰</button>
        </div>

        <div class="hint">
          ğŸ“Œ ä½ é‚„æ²’æ‰¾ç…§ç‰‡ä¹Ÿæ²’é—œä¿‚ï¼šæ¯å¼µå¡ç‰‡éƒ½æœƒé¡¯ç¤º <b>eventId</b> èˆ‡ã€Œç…§ç‰‡æ‡‰è©²æ”¾çš„è³‡æ–™å¤¾è·¯å¾‘ã€ã€‚<br/>
          âœ… ä¹‹å¾Œä½ åªè¦æŠŠç…§ç‰‡ä¸Šå‚³åˆ°ï¼š<span class="mono">images/å¹´ä»½/eventId/01.jpg</span>ã€<span class="mono">02.jpg</span>â€¦ ç¶²ç«™æœƒè‡ªå‹•é¡¯ç¤ºã€‚
        </div>

        <div class="event-list" id="eventList"></div>
      </aside>
    </div>

    <footer class="footer">
      ç…§ç‰‡è¦å‰‡ï¼š<span class="mono">images/2024/2024-01-winter-duck/01.jpg</span>ã€<span class="mono">02.jpg</span>â€¦ï¼ˆè‹±æ–‡æª”åæœ€ç©©ï¼‰ã€‚<br/>
      åœ°åœ–ï¼šOpenStreetMap + Leafletï¼ˆåº§æ¨™ç‚ºè¿‘ä¼¼ä½ç½®ï¼Œå¯å†å¾®èª¿ï¼‰ã€‚
    </footer>
  </div>


  <!-- Lightboxï¼šé»ç¸®åœ–æ”¾å¤§ + é¡¯ç¤ºä¾†æºç¶²å€ -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
    <div class="lightbox-backdrop" id="lightboxBackdrop" data-close="1"></div>
    <div class="lightbox-panel" role="dialog" aria-modal="true" aria-label="åœ–ç‰‡æ”¾å¤§æª¢è¦–">
      <button class="lightbox-close" id="lightboxClose" aria-label="é—œé–‰">âœ•</button>
      <div class="lightbox-imgwrap">
        <img id="lightboxImg" alt="æ”¾å¤§åœ–ç‰‡"/>
      </div>
      <div class="lightbox-meta">
        <div><b>åœ–ç‰‡è·¯å¾‘ï¼š</b><span class="mono" id="lightboxPath"></span></div>
        <div><b>åœ–ç‰‡ä¾†æºç¶²å€ï¼š</b><a id="lightboxSrc" href="#" target="_blank" rel="noopener noreferrer"></a></div>
      </div>
    </div>
  </div>


<script>
  // ========= åœ°é»ï¼ˆåœ°åœ–ä¸Šæ¯å€‹åœ°é»ä¸€å€‹åœ–é‡˜ï¼‰ =========
  const PLACES = [
    { id:"meinong", name:"ç¾æ¿ƒå®¢å®¶æ–‡ç‰©é¤¨", lat:22.9005, lng:120.5420 },
    { id:"love_river_bay", name:"æ„›æ²³ç£", lat:22.6178, lng:120.2889 },
    { id:"kmc", name:"é«˜é›„æµè¡ŒéŸ³æ¨‚ä¸­å¿ƒï¼ˆé«˜æµï¼‰", lat:22.6169, lng:120.2874 },
    { id:"penglai", name:"è“¬èŠå•†æ¸¯å€", lat:22.6199, lng:120.2817 },
    { id:"pier2", name:"é§äºŒè—è¡“ç‰¹å€", lat:22.6205, lng:120.2799 },
    { id:"kaohsiung_harbor", name:"é«˜é›„æ¸¯ç£ / æ¸¯å€", lat:22.6130, lng:120.2850 },
    { id:"love_river", name:"æ„›æ²³", lat:22.6305, lng:120.2955 },
    { id:"weiwuying", name:"è¡›æ­¦ç‡Ÿ", lat:22.6255, lng:120.3452 },
    { id:"nknu", name:"é«˜å¸«å¤§ï¼ˆé«˜é›„å¸«ç¯„å¤§å­¸ï¼‰", lat:22.6276, lng:120.3320 },
    { id:"dream_mall", name:"å¤¢æ™‚ä»£ / æ™‚ä»£å¤§é“", lat:22.59515, lng:120.30692 },
    { id:"lotus_lake", name:"å·¦ç‡Ÿè“®æ± æ½­", lat:22.6842, lng:120.2975 },
    { id:"arena", name:"é«˜é›„å·¨è›‹", lat:22.6692, lng:120.3017 },
    { id:"world_games", name:"ä¸–é‹ä¸»å ´é¤¨ï¼ˆåœ‹å®¶é«”è‚²å ´ï¼‰", lat:22.7023, lng:120.2947 },
    { id:"qijin", name:"æ——æ´¥æµ·æ°´æµ´å ´", lat:22.61018, lng:120.2669 },
    { id:"pier7", name:"é«˜é›„æ¸¯ä¸ƒè™Ÿç¢¼é ­", lat:22.6138, lng:120.2835 },
    { id:"aozihdi", name:"å‡¹å­åº•æ£®æ—å…¬åœ’", lat:22.6637, lng:120.3020 },
    { id:"central_park", name:"ä¸­å¤®å…¬åœ’", lat:22.6246, lng:120.3006 },
    { id:"city_hall", name:"é«˜é›„å¸‚æ”¿åºœï¼ˆå››ç¶­è¡Œæ”¿ä¸­å¿ƒï¼‰", lat:22.6230, lng:120.3140 },
    { id:"science_museum", name:"åœ‹ç«‹ç§‘å·¥é¤¨", lat:22.6399, lng:120.3248 },
  ];
  const placeById = Object.fromEntries(PLACES.map(p => [p.id, p]));

  // ========= æ´»å‹•ï¼ˆ2020ï½2026/01/01 ï¼‰ =========
  const EVENTS = [
    { id:"2020-10-meinong-hakka-trip", year:2020, month:10, monthLabel:"10æœˆ", name:"å¥½å®¢æ—…éŠå»", kind:"æ°‘ä¿—æ–‡åŒ–", places:["meinong"] },
    { id:"2020-12-newyear-cross-lightyears", year:2020, month:12, monthLabel:"12æœˆ", name:"è·¨ç™¾å…‰å¹´è·¨å¹´æ™šæœƒ", kind:"ç¯€æ…¶ï¼ˆå¸‚é•·é¦–å ´ï¼‰", places:["love_river_bay","kmc","penglai"] },

    { id:"2021-03-megaport-restart", year:2021, month:3, monthLabel:"03æœˆ", name:"å¤§æ¸¯é–‹å”±ï¼ˆå¾©è¾¦é¦–å¹´ï¼‰", kind:"éŸ³æ¨‚ç¥­", places:["pier2"] },
    { id:"2021-05-ocean-party", year:2021, month:5, monthLabel:"05æœˆ", name:"é«˜é›„æµ·æ´‹æ´¾å°", kind:"æ°´åŸŸä¼‘é–’", places:["love_river_bay"] },
    { id:"2021-10-national-day-fireworks", year:2021, month:10, monthLabel:"10æœˆ", name:"åœ‹æ…¶ç…™ç«åœ¨é«˜é›„", kind:"åœ‹å®¶æ…¶å…¸", places:["kaohsiung_harbor"] },
    { id:"2021-11-dragonboat-carnival", year:2021, month:11, monthLabel:"11æœˆ", name:"åœ‹æ…¶é¾èˆŸå˜‰å¹´è¯", kind:"é‹å‹•è³½äº‹", places:["love_river"] },
    { id:"2021-12-newyear-2022-dual-stage", year:2021, month:12, monthLabel:"12æœˆ", name:"2022 é«˜é›„è·¨å¹´ï¼ˆé›™èˆå°ï¼‰", kind:"ç¯€æ…¶æ™šæœƒ", places:["kmc","penglai"] },

    { id:"2022-02-taiwan-lantern-festival", year:2022, month:2, monthLabel:"02æœˆ", name:"2022 å°ç£ç‡ˆæœƒï¼ˆé›™ä¸»å ´ï¼‰", kind:"åœ‹éš›ç´šç¯€æ…¶", places:["weiwuying","love_river_bay"] },
    { id:"2022-03-ksaf", year:2022, month:3, monthLabel:"03æœˆ", name:"é«˜é›„æ˜¥å¤©è—è¡“ç¯€ï¼ˆKSAFï¼‰", kind:"è—æ–‡ç››æœƒ", places:["weiwuying","nknu"] },
    { id:"2022-08-creativexpo-floating", year:2022, month:8, monthLabel:"08æœˆ", name:"å°ç£æ–‡åšæœƒï¼ˆèŠç™‚æ¼‚æ¼‚æ²³ï¼‰", kind:"è—æ–‡ IP", places:["love_river_bay","kmc"] },
    { id:"2022-10-design-expo", year:2022, month:10, monthLabel:"10æœˆ", name:"å°ç£è¨­è¨ˆå±•ï¼ˆè¨­è¨ˆä¸­å³¶ï¼‰", kind:"è—æ–‡è¨­è¨ˆ", places:["penglai"] },
    { id:"2022-10-takao-rock", year:2022, month:10, monthLabel:"10æœˆ", name:"Takao Rock æ‰“ç‹—ç¥­", kind:"éŸ³æ¨‚ç¥­", places:["kmc"] },
    { id:"2022-12-newyear-2023-yawan", year:2022, month:12, monthLabel:"12æœˆ", name:"2023 è·¨å¹´äºç£æœªä¾†å¸‚", kind:"ç¯€æ…¶æ™šæœƒ", places:["dream_mall"] },

    { id:"2023-01-lotus-lake-lantern", year:2023, month:1, monthLabel:"01æœˆ", name:"è“®æ½­ç‡ˆæœƒï¼ˆèŒå…”ï¼‰", kind:"ç¯€æ…¶ï¼ˆé¦–åº¦ç§»å¸«ï¼‰", places:["lotus_lake"] },
    { id:"2023-02-westlife-bsb", year:2023, month:2, monthLabel:"02æœˆ", name:"Westlife & Backstreet Boys", kind:"åœ‹éš›æ¼”å”±æœƒ", places:["arena","world_games"] },
    { id:"2023-03-blackpink-born-pink", year:2023, month:3, monthLabel:"03æœˆ", name:"BLACKPINKï¼»BORN PINKï¼½", kind:"åœ‹éš›æ¼”å”±æœƒ", places:["world_games"] },
    { id:"2023-04-a-mei-and-megaport", year:2023, month:4, monthLabel:"04æœˆ", name:"å¼µæƒ å¦¹ ASMR / å¤§æ¸¯é–‹å”±", kind:"éŸ³æ¨‚æ…¶å…¸", places:["arena","pier2"] },
    { id:"2023-08-qijin-kite", year:2023, month:8, monthLabel:"08æœˆ", name:"æ——æ´¥é¢¨ç®ç¯€", kind:"è¦ªå­è§€å…‰", places:["qijin"] },
    { id:"2023-10-green-knights-show", year:2023, month:10, monthLabel:"10æœˆ", name:"ç¿¡ç¿ é¨å£«ï¼ˆæ—¥è¾²äºŒé«˜ï¼‰å±•æ¼”", kind:"åœ‹éš›äº¤æµ", places:["pier7"] },
    { id:"2023-11-coldplay", year:2023, month:11, monthLabel:"11æœˆ", name:"Coldplay é…·ç©æ¨‚åœ˜", kind:"åœ‹éš›æ¼”å”±æœƒ", places:["world_games"] },
    { id:"2023-12-newyear-2024", year:2023, month:12, monthLabel:"12æœˆ", name:"2024 è·¨å¹´æ™šæœƒ", kind:"ç¯€æ…¶æ™šæœƒ", places:["dream_mall"] },

    { id:"2024-01-winter-duck", year:2024, month:1, monthLabel:"01æœˆ", name:"å†¬æ—¥éŠæ¨‚åœ’ï¼ˆé»ƒè‰²å°é´¨å›æ­¸ï¼‰", kind:"åœ‹éš›äº®é» IP", places:["love_river_bay"] },
    { id:"2024-02-ed-sheeran", year:2024, month:2, monthLabel:"02æœˆ", name:"Ed Sheeran ç´…é«®è‰¾å¾·", kind:"åœ‹éš›æ¼”å”±æœƒ", places:["world_games"] },
    { id:"2024-03-sakura-mayday", year:2024, month:3, monthLabel:"03æœˆ", name:"é«˜é›„æ«»èŠ±å­£ / äº”æœˆå¤©", kind:"éŸ³æ¨‚ç¥­ / æ¼”å”±æœƒ", places:["dream_mall","world_games"] },
    { id:"2024-04-golden-wave", year:2024, month:4, monthLabel:"04æœˆ", name:"Golden Wave in Taiwan", kind:"éŸ“æµæ‹¼ç›¤", places:["world_games"] },
    { id:"2024-07-beer-festival", year:2024, month:7, monthLabel:"07æœˆ", name:"é«˜é›„å•¤é…’éŸ³æ¨‚ç¯€", kind:"å•†æ¥­ç¥­å…¸", places:["dream_mall"] },
    { id:"2024-09-bruno-mars", year:2024, month:9, monthLabel:"09æœˆ", name:"Bruno Mars ç«æ˜Ÿäººå¸ƒé­¯è«¾", kind:"åœ‹éš›æ¼”å”±æœƒ", places:["world_games"] },
    { id:"2024-09-one-ok-rock", year:2024, month:9, monthLabel:"09æœˆ", name:"ONE OK ROCK æ¼”å”±æœƒ", kind:"åœ‹éš›æ¼”å”±æœƒ", places:["world_games"] },
    { id:"2024-10-orange-devils-greenknights", year:2024, month:10, monthLabel:"10æœˆ", name:"æ©˜è‰²æƒ¡é­”ã€ç¿¡ç¿ é¨å£«å›è¨ª", kind:"åœ‹éš›äº¤æµ", places:["kaohsiung_harbor"] },
    { id:"2024-10-takao-rock-halloween", year:2024, month:10, monthLabel:"10æœˆ", name:"æ‰“ç‹—ç¥­ / è¬è–ç¯€å¤§éŠè¡Œ", kind:"éŸ³æ¨‚ / ç¯€æ…¶", places:["kmc","aozihdi"] },
    { id:"2024-11-stray-kids", year:2024, month:11, monthLabel:"11æœˆ", name:"Stray Kids ä¸–ç•Œå·¡è¿´", kind:"éŸ“æµæ¼”å”±æœƒ", places:["world_games"] },
    { id:"2024-12-lisa-meet", year:2024, month:12, monthLabel:"12æœˆ", name:"Lisaï¼ˆBlackpinkï¼‰è¦‹é¢æœƒ", kind:"åœ‹éš›æ¼”å”±æœƒ", places:["arena"] },
    { id:"2024-12-squid-game-2", year:2024, month:12, monthLabel:"12æœˆ", name:"é­·é­šéŠæˆ² 2 é€²é§é«˜é›„", kind:"åœ‹éš› IP å¿«é–ƒ", places:["pier2"] },
    { id:"2024-12-christmas-life-2025", year:2024, month:12, monthLabel:"12æœˆ", name:"2025 è–èª•ç”Ÿæ´»ç¯€", kind:"ç¯€æ…¶é»ç‡ˆ", places:["central_park"] },

    { id:"2025-01-newyear-2025", year:2025, month:1, monthLabel:"01æœˆ", name:"2025 è·¨å¹´æ™šæœƒ / å…ƒæ—¦å‡æ——", kind:"ç¯€æ…¶æ™šæœƒ", places:["dream_mall","city_hall"] },
    { id:"2025-01-day6", year:2025, month:1, monthLabel:"01æœˆ", name:"DAY6 ä¸–ç•Œå·¡è¿´æ¼”å”±æœƒ", kind:"éŸ“æµæ¼”å”±æœƒ", places:["kmc"] },
    { id:"2025-02-maroon5", year:2025, month:2, monthLabel:"02æœˆ", name:"Maroon 5 é­”åŠ›ç´…", kind:"åœ‹éš›æ¼”å”±æœƒ", places:["world_games"] },
    { id:"2025-02-winter-chiikawa", year:2025, month:2, monthLabel:"02æœˆ", name:"å†¬æ—¥éŠæ¨‚åœ’ï¼ˆå‰ä¼Šå¡å“‡ï¼‰", kind:"ç™‚ç™’ IP å±•", places:["pier2","love_river_bay"] },
    { id:"2025-03-megaport-sakura", year:2025, month:3, monthLabel:"03æœˆ", name:"2025 å¤§æ¸¯é–‹å”± / æ«»èŠ±å­£", kind:"éŸ³æ¨‚ç¥­", places:["pier2","dream_mall"] },
    { id:"2025-08-qijin-summer", year:2025, month:8, monthLabel:"08æœˆ", name:"æ——æ´¥é¢¨ç®ç¯€æš¨æ°£å¢Šæ°´æ¨‚åœ’", kind:"æš‘å‡æ´»å‹•", places:["qijin"] },
    { id:"2025-10-takao-rock-2025", year:2025, month:10, monthLabel:"10æœˆ", name:"2025 æ‰“ç‹—ç¥­", kind:"éŸ³æ¨‚ç¥­", places:["kmc"] },
    { id:"2025-11-doraemon", year:2025, month:11, monthLabel:"11æœˆ", name:"100% å“†å•¦Aå¤¢ç‰¹å±•", kind:"IP ç‰¹å±•", places:["science_museum"] },
    { id:"2025-12-newyear-2026", year:2025, month:12, monthLabel:"12æœˆ", name:"2026 è·¨å¹´æ™šæœƒã€Œé›„å—¨è¶´ã€", kind:"ç¯€æ…¶æ™šæœƒ", places:["dream_mall"] },

    { id:"2026-01-newyear-dawn", year:2026, month:1, monthLabel:"01æœˆ", name:"2026 å…ƒæ—¦å‡æ—— / æ™¨æ›¦æ¼”å”±æœƒ", kind:"ç¯€æ…¶", places:["kmc"] },
    { id:"2026-01-superjunior-ss10", year:2026, month:1, monthLabel:"01æœˆ", name:"Super Junior SS10ï¼ˆ1/23-25ï¼‰", kind:"åœ‹éš›æ¼”å”±æœƒ", places:["arena"] },
  ];

  // ========= ç‹€æ…‹ =========
  let activePlace = "all"; // "all" or place id
  let activeYear = "all";  // "all" or number string

  const scopeTitleEl = document.getElementById("scopeTitle");
  const scopeSubEl   = document.getElementById("scopeSub");
  const yearFiltersEl= document.getElementById("yearFilters");
  const eventListEl  = document.getElementById("eventList");

  const placeSelectEl = document.getElementById("placeSelect");

  // =========ï¼ˆå¯é¸ï¼‰åœ–ç‰‡ä¾†æºç¶²å€å°ç…§è¡¨ =========
  // å¦‚æœä½ æ“”å¿ƒã€Œå·åœ–ã€çˆ­è­°ï¼Œå¯ä»¥æŠŠæ¯å¼µåœ–ç‰‡çš„åŸå§‹ä¾†æºç¶²å€å¡«åœ¨é€™è£¡ã€‚
  // keyï¼šåœ–ç‰‡åœ¨ç¶²ç«™ä¸Šçš„è·¯å¾‘ï¼ˆä¾‹å¦‚ "images/2026/2026-01-newyear-dawn/01.jpg"ï¼‰
  // valueï¼šåŸå§‹ä¾†æºç¶²å€ï¼ˆä¾‹å¦‚ "https://example.com/original-post"ï¼‰
 const PHOTO_SOURCES = {
  "images/2025/2025-12-newyear-2026/01.jpg": "https://taidaily.com/2026/01/01/563572/",
  "images/2025/2025-12-newyear-2026/02.jpg": "https://taidaily.com/2026/01/01/563572/",
  "images/2025/2025-12-newyear-2026/03.jpg": "https://taidaily.com/2026/01/01/563572/",
  "images/2025/2025-12-newyear-2026/04.jpg": "https://taidaily.com/2026/01/01/563572/",
};

  // ========= å¹´ä»½ï¼šä¾åœ°é»å‹•æ…‹ç”¢ç”Ÿï¼ˆæŸåœ°é»æŸå¹´æ²’æ´»å‹•å°±ä¸é¡¯ç¤ºè©²å¹´ï¼‰ =========
  function getAvailableYears(){
    let list = EVENTS;
    if (activePlace !== "all") list = list.filter(e => e.places.includes(activePlace));
    return Array.from(new Set(list.map(e => e.year))).sort((a,b)=>a-b);
  }
  function ensureActiveYearValid(){
    const years = getAvailableYears();
    if (activeYear !== "all" && !years.includes(Number(activeYear))){
      activeYear = "all";
    }

  // ========= åœ°é»ä¸‹æ‹‰é¸å–®ï¼ˆé¿å…ä¸€æ¬¡é¡¯ç¤ºå¤ªå¤šåœ°é»é€ æˆé é¢è®Šé•·ï¼‰ =========
 }
  function renderYearFilters(){
    ensureActiveYearValid();
    const years = getAvailableYears();
    const buttons = ["all", ...years];

    yearFiltersEl.innerHTML = buttons.map(y=>{
      const label = y === "all" ? "å…¨éƒ¨å¹´ä»½" : String(y);
      const isActive = String(y) === String(activeYear);
      return `<button class="pill ${isActive ? "active":""}" data-year="${y}">${label}</button>`;
    }).join("");

    yearFiltersEl.querySelectorAll("button").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        activeYear = btn.dataset.year;
        renderYearFilters();
        renderEvents();
      });
    });
  }

  // ========= ç…§ç‰‡è¦å‰‡ï¼šä½ ä¸Šå‚³ç…§ç‰‡åˆ°æŒ‡å®šè³‡æ–™å¤¾å°±æœƒè‡ªå·±é¡¯ç¤º =========
  // æœƒè‡ªå‹•å˜—è©¦è¼‰å…¥ images/{year}/{eventId}/01.jpg ~ 06.jpg
  function expectedFolder(ev){
    return `images/${ev.year}/${ev.id}/`;
  }

  function tryLoadImage(url){
    return new Promise(resolve=>{
      const img = new Image();
      img.onload = ()=> resolve(url);
      img.onerror= ()=> resolve(null);
      img.src = url + `?v=${Date.now()}`; // é¿å…å¿«å–å¡ä½ï¼ˆä¸Šå‚³å¾Œç«‹åˆ»åˆ·æ–°æ¯”è¼ƒæº–ï¼‰
    });
  }

  async function loadEventPhotos(ev){
    const base = expectedFolder(ev);
    const candidates = [];
    for (let i=1;i<=6;i++){
      const n = String(i).padStart(2,"0");
      candidates.push(`${base}${n}.jpg`);
    }

    const results = await Promise.all(candidates.map(tryLoadImage));
    return results.filter(Boolean);
  }

  // ========= å³å´åˆ—è¡¨ =========
  function renderEvents(){
    const year = (activeYear === "all") ? null : Number(activeYear);

    let list = EVENTS.slice();
    if (year) list = list.filter(e => e.year === year);
    if (activePlace !== "all") list = list.filter(e => e.places.includes(activePlace));

    // æ–°åˆ°èˆŠ
    list.sort((a,b)=>{
      if (a.year !== b.year) return b.year - a.year;
      if (a.month !== b.month) return b.month - a.month;
      return a.name.localeCompare(b.name, "zh-Hant");
    });

    // æ›´æ–°æ¨™é¡Œ
    if (activePlace === "all"){
      scopeTitleEl.textContent = "å…¨éƒ¨åœ°é»";
    } else {
      scopeTitleEl.textContent = placeById[activePlace]?.name || "å–®ä¸€åœ°é»";
    }
    scopeSubEl.textContent = `ç›®å‰é¡¯ç¤ºï¼š${activeYear === "all" ? "å…¨éƒ¨å¹´ä»½" : activeYear} Â· å…± ${list.length} ç­†æ´»å‹•`;

    if (!list.length){
      eventListEl.innerHTML = `<div class="hint">ç›®å‰æ¢ä»¶ä¸‹æ²’æœ‰æ´»å‹•ï¼Œè«‹åˆ‡æ›å¹´ä»½æˆ–æ¸…é™¤åœ°é»ç¯©é¸ã€‚</div>`;
      return;
    }

    eventListEl.innerHTML = list.map(ev=>{
      const placeNames = ev.places.map(pid => placeById[pid]?.name || pid).join("ã€");
      const folder = expectedFolder(ev);

      // å…ˆæ”¾ placeholderï¼Œç­‰ç…§ç‰‡çœŸçš„å­˜åœ¨å†æ›æˆç…§ç‰‡
      const placeholderThumbs = Array.from({length:2}).map((_,idx)=>{
        return `<div class="thumb placeholder" id="ph-${ev.id}-${idx}"></div>`;
      }).join("");

      return `
        <article class="event-card" id="card-${ev.id}">
          <div class="event-header">
            <span class="event-date">${ev.year} å¹´ ${ev.monthLabel}</span>
            <span class="event-name">${ev.name}</span>
          </div>

          <div class="event-meta">
            <span class="tag"><span class="tag-dot"></span><span>${ev.kind}</span></span>
            <span class="tag">${placeNames}</span>
          </div>

          <div class="photo-row" id="photos-${ev.id}">
            ${placeholderThumbs}
          </div>

          <div class="missing-box">
            <div>ğŸ“Œ <b>eventIdï¼š</b><span class="mono">${ev.id}</span></div>
            <div>ğŸ“ <b>ç…§ç‰‡æ”¾é€™è£¡ï¼š</b><span class="mono">${folder}</span></div>
            <div>ğŸ–¼ æª”åå»ºè­°ï¼š<span class="mono">01.jpg</span>ã€<span class="mono">02.jpg</span>ã€<span class="mono">03.jpg</span>â€¦ï¼ˆæœ€å¤šè‡ªå‹•æŠ“åˆ° 06.jpgï¼‰</div>
          </div>
        </article>
      `;
    }).join("");

    // éåŒæ­¥è¼‰å…¥ç…§ç‰‡ï¼ˆæœ‰å°±é¡¯ç¤ºï¼Œæ²’æœ‰å°±ä¿ç•™ placeholderï¼‰
    list.forEach(async ev=>{
      const urls = await loadEventPhotos(ev);
      const container = document.getElementById(`photos-${ev.id}`);
      if (!container) return;

      if (!urls.length){
        // æ²’ç…§ç‰‡ï¼šä¿ç•™ placeholder
        return;
      }

      container.innerHTML = urls.map(url=>{
        const src = PHOTO_SOURCES[url] || url;
        return `<button class="thumb thumb-btn" type="button" aria-label="æ”¾å¤§åœ–ç‰‡" data-img="${url}" data-src="${src}" style="background-image:url('${url}')"></button>`;
      }).join("");
    });
  }

  // ========= ç¸®åœ–é»æ“Šï¼šæ”¾å¤§æª¢è¦–ï¼ˆå«ä¾†æºç¶²å€ï¼‰ =========
  const lightboxEl = document.getElementById("lightbox");
  const lightboxImg = document.getElementById("lightboxImg");
  const lightboxPath = document.getElementById("lightboxPath");
  const lightboxSrc = document.getElementById("lightboxSrc");
  const lightboxClose = document.getElementById("lightboxClose");
  const lightboxBackdrop = document.getElementById("lightboxBackdrop");

  function openLightbox(imgUrl, srcUrl){
    lightboxImg.src = imgUrl;
    lightboxPath.textContent = imgUrl;
    lightboxSrc.textContent = srcUrl || imgUrl;
    lightboxSrc.href = srcUrl || imgUrl;

    lightboxEl.classList.add("open");
    lightboxEl.setAttribute("aria-hidden","false");
    document.body.style.overflow = "hidden";
  }

  function closeLightbox(){
    lightboxEl.classList.remove("open");
    lightboxEl.setAttribute("aria-hidden","true");
    document.body.style.overflow = "hidden";
    lightboxImg.src = "";
  }

// ç”¨äº‹ä»¶å§”æ´¾ï¼Œé¿å…æ¯æ¬¡é‡ç¹ªéƒ½ç¶ä¸€å † listener
eventListEl.addEventListener("click", (e)=>{
  const btn = e.target.closest(".thumb-btn");
  if (!btn) return;

  const imgUrl = btn.dataset.img;
  const srcUrl = btn.dataset.src || btn.dataset.img;

  if (!imgUrl) return;
  openLightbox(imgUrl, srcUrl);
});

  lightboxClose.addEventListener("click", closeLightbox);
  lightboxBackdrop.addEventListener("click", closeLightbox);
  document.addEventListener("keydown", (e)=>{
    if (e.key === "Escape" && lightboxEl.classList.contains("open")){
      closeLightbox();
    }
  });
eventListEl.addEventListener("click", (e)=>{
  const btn = e.target.closest(".thumb-btn");
  if (!btn) return;

  console.log("IMG:", btn.dataset.img, "SRC:", btn.dataset.src);

  const imgUrl = btn.dataset.img;
  const srcUrl = btn.dataset.src || btn.dataset.img;
  if (!imgUrl) return;
  openLightbox(imgUrl, srcUrl);
});

  // ========= åœ°åœ–ï¼ˆåœ–é‡˜æ¨™è¨˜ï¼‰ =========
  const map = L.map("map").setView([22.63, 120.30], 12);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution: "&copy; OpenStreetMap è²¢ç»è€…"
  }).addTo(map);

  const PIN_ICON = L.divIcon({
    className: "pin-icon",
    html: `
      <svg width="28" height="44" viewBox="0 0 28 44" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M14 43C14 43 3 28.7 3 18C3 10.8 8.1 5 14 5C19.9 5 25 10.8 25 18C25 28.7 14 43 14 43Z"
              fill="#B95756" stroke="#8F4A49" stroke-width="2"/>
        <circle cx="14" cy="18" r="6" fill="#f4f1ec" stroke="#9a8c98" stroke-width="2"/>
      </svg>
    `,
    iconSize: [28, 44],
    iconAnchor: [14, 44],
    tooltipAnchor: [0, -34]
  });

  // åªé¡¯ç¤ºæœ‰è¢«æ´»å‹•ä½¿ç”¨åˆ°çš„åœ°é»
  const usedPlaceIds = new Set(EVENTS.flatMap(e => e.places));
  PLACES.filter(p => usedPlaceIds.has(p.id)).forEach(p=>{
    const marker = L.marker([p.lat, p.lng], { icon: PIN_ICON }).addTo(map);
    marker.bindTooltip(p.name, { direction:"top" });

    marker.on("click", ()=>{
      activePlace = p.id;
      placeSelectEl.value = p.id;
      renderYearFilters(); // â˜… åœ°é»åˆ‡æ›å¾Œï¼šå¹´ä»½é¸é …å‹•æ…‹æ›´æ–°ï¼ˆåªç•™æœ‰æ´»å‹•çš„å¹´ä»½ï¼‰
      renderEvents();
    });
  });

  document.getElementById("clearPlace").addEventListener("click", ()=>{
    activePlace = "all";
    placeSelectEl.value = "all";
    renderYearFilters();
    renderEvents();
  });

  // init
  renderPlaceSelect();
  renderYearFilters();
  renderEvents();
</script>
</body>
</html>












